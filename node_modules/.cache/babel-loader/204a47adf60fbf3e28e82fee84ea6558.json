{"ast":null,"code":"var _jsxFileName = \"/Users/douglasmorais/Documents/GitHub/desafio-accenture-react/src/Pages/Login/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useRef, useState } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { FaArrowRight } from 'react-icons/fa';\nimport { Form } from '@unform/web';\nimport * as yup from 'yup';\nimport Button from '../../components/Button';\nimport Header from '../../components/Header';\nimport api from '../../services/api';\nimport updateReduxState from '../../services/updateReduxState';\nimport Loader from '../../components/Loader';\nimport Input from '../../components/Input';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Login = () => {\n  _s();\n\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const history = useHistory();\n  const formRef = useRef(null);\n  const handleSubmit = useCallback(async data => {\n    const filteredData = {};\n    Object.keys(data).forEach(key => {\n      filteredData[key] = data[key].trim();\n    });\n    setLoading(true);\n\n    try {\n      var _formRef$current;\n\n      (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n      const schema = yup.object().shape({\n        username: yup.string().required('Nome de usuário obrigatório '),\n        password: yup.string().required('Senha obrigatória')\n      });\n      await schema.validate(filteredData, {\n        abortEarly: false\n      });\n      const {\n        data: response\n      } = await api.post('/login', {\n        \"usuario\": username,\n        \"senha\": password\n      });\n      localStorage.setItem('@token_user', response.token);\n      localStorage.setItem('@user_name', response.usuario.nome);\n      updateReduxState();\n      toast.success('Seja bem-vindo(a)'); //redirecionar para dashboard;\n    } catch (err) {\n      var _formRef$current2;\n\n      const errors = getValidationErrors(err);\n      (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setErrors(errors);\n\n      if (Object.keys(err).includes('isAxiosError')) {\n        toast.error('Ocorreu algum erro!');\n        return; //redirecionar para página de erro;\n      }\n\n      setLoading(false);\n      toast.error('Usuario ou senha incorretos!');\n    } finally {\n      setLoading(false);\n    }\n  }, [username, password, history]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      ref: formRef,\n      onSubmit: handleSubmit,\n      children: [\"Fa\\xE7a o login\", /*#__PURE__*/_jsxDEV(Input, {\n        name: \"username\",\n        value: username,\n        onChange: e => setUsername(e.target.value),\n        placeholder: \"Digite seu usu\\xE1rio\",\n        autoFocus: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        name: \"password\",\n        value: password,\n        onChange: e => setPassword(e.target.value),\n        placeholder: \"Digite sua senha\",\n        type: \"password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this), loading ? /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 22\n      }, this) : /*#__PURE__*/_jsxDEV(Button, {\n        type: \"submit\",\n        text: \"Continuar\",\n        Icon: FaArrowRight,\n        className: \"form-button\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 35\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/recover\",\n        children: \"Esqueci minha senha\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        children: \"Ainda n\\xE3o sou cliente\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Login, \"Cdu7pYZXACUrEXgVsKQV1JtTZ2k=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/douglasmorais/Documents/GitHub/desafio-accenture-react/src/Pages/Login/index.tsx"],"names":["React","useCallback","useRef","useState","Link","useHistory","toast","FaArrowRight","Form","yup","Button","Header","api","updateReduxState","Loader","Input","getValidationErrors","Login","username","setUsername","password","setPassword","loading","setLoading","history","formRef","handleSubmit","data","filteredData","Object","keys","forEach","key","trim","current","setErrors","schema","object","shape","string","required","validate","abortEarly","response","post","localStorage","setItem","token","usuario","nome","success","err","errors","includes","error","e","target","value"],"mappings":"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","sourcesContent":["import React, { useCallback, useRef, useState } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { FaArrowRight } from 'react-icons/fa';\nimport { Form } from '@unform/web';\nimport * as yup from 'yup';\n\nimport Button from '../../components/Button';\nimport Header from '../../components/Header';\n\nimport api from '../../services/api';\nimport { UserResponse } from '../../types/user';\nimport updateReduxState from '../../services/updateReduxState';\nimport Loader from '../../components/Loader';\nimport Input from '../../components/Input';\nimport { FormHandles } from '@unform/core';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { AnyObject } from '../../types/utils';\n\nconst Login: React.FC = () => {\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const history = useHistory();\n  const formRef = useRef<FormHandles>(null);\n\n  const handleSubmit = useCallback(async (data: AnyObject) => {\n    const filteredData: AnyObject = {}\n\n    Object.keys(data).forEach(key => {\n      filteredData[key] = data[key].trim();\n    });\n\n    setLoading(true);\n    try {\n      formRef.current?.setErrors({});\n\n      const schema = yup.object().shape({\n        username: yup.string().required('Nome de usuário obrigatório '),\n        password: yup.string().required('Senha obrigatória'),\n      });\n\n      await schema.validate(filteredData, {\n        abortEarly: false\n      })\n\n      const { data: response } = await api.post<UserResponse>('/login', {\n        \"usuario\": username,\n        \"senha\": password\n      });\n      localStorage.setItem('@token_user', response.token);\n      localStorage.setItem('@user_name', response.usuario.nome);\n      updateReduxState();\n      toast.success('Seja bem-vindo(a)');\n      //redirecionar para dashboard;\n    }\n    catch (err) {\n      const errors = getValidationErrors(err);\n      formRef.current?.setErrors(errors);\n      if (Object.keys(err).includes('isAxiosError')) {\n        toast.error('Ocorreu algum erro!');\n        return //redirecionar para página de erro;\n      }\n      setLoading(false);\n      toast.error('Usuario ou senha incorretos!');\n    } finally {\n      setLoading(false);\n    }\n\n  }, [username, password, history]);\n\n  return (\n    <>\n      <Header />\n        <Form ref={formRef} onSubmit={handleSubmit}>\n          Faça o login\n\n          <Input name=\"username\" value={username} onChange={e => setUsername(e.target.value)} placeholder=\"Digite seu usuário\" autoFocus />\n          <Input name=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Digite sua senha\" type=\"password\" />\n\n          {loading ? <Loader /> : <Button\n            type=\"submit\"\n            text=\"Continuar\"\n            Icon={FaArrowRight}\n            className=\"form-button\"\n          />\n          }\n\n          <Link to=\"/recover\">Esqueci minha senha</Link>\n          <Link to=\"/\">Ainda não sou cliente</Link>\n        </Form>\n    </>\n  );\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}